# LOVE20 行动扩展协议之 LP 质押扩展协议

## 0. 关于协议

此扩展协议，基于 LOVE20 扩展协议标准，扩展行动参与机制，允许以 LP 质押的方式参与行动。

- 参与者可质押 LP 代币以获得被验证并获得激励的资格
- 申请解除质押并立即失去激励资格，并在等待完整的解锁阶段数后，随时取回质押的代币
- 自动生成验证结果，根据 `MIN(治理票占比 * 倍数, 代币占比)` 权重分配激励

## 1. 核心优势

### 1.1 自动化公平验证

在关键交互点自动触发验证结果生成，无需治理者人工验证

### 1.2 防止闪电贷攻击

无法在一个区块内完成质押、获取激励、并取回质押资产，可从根本上杜绝闪电贷攻击

### 1.3 长期主义激励机制

可通过初始化时设定的解锁期参数，来控制对长期主义的筛选和激励力度

## 2. 初始参数

### 2.1 最小治理票数 (minGovVotes)

首次质押代币时，参与者必须持有大于等于 `minGovVotes` 的治理票数，以确保参与者对行动有一定的治理参与度。

### 2.2 等待阶段数 (waitingPhases)

申请解锁代币后，需要等待完整的 `waitingPhases` 个阶段后，才能取回质押的代币。在此期间，该地址将无法被验证并获得激励。

### 2.3 质押代币地址(stakeTokenAddress)

可质押的代币地址

### 2.4 治理票占比倍数 (govRatioMultiplier)

在计算分数时，治理票占比会乘以 `govRatioMultiplier`，用于调整治理票在分数计算中的权重。

## 3. 参与者

### 3.1 代币质押

参与者可以质押代币以获得被验证并获得激励的资格。

质押条件：

- 首次质押：必须持有至少 `minGovVotes` 的治理票数
- 不能处于解锁申请状态（`requestedUnstakeRound != 0`）
- 质押数量必须大于 0

### 3.2 代币解锁

参与者可以随时申请解锁质押代币，进入解锁期。

### 3.3 代币取回

等待完整的 `waitingPhases` 个阶段后可取回质押代币

### 3.4 铸造激励

参与者可以在验证阶段完成后，铸造行动激励。

激励根据以下公式分配：

```
分数 = MIN(代币占比, 治理票占比 * govRatioMultiplier)
激励 = 行动总激励 * 分数 / 总分数
```

其中：

- 代币占比 = 质押代币数量 / 代币总供应量
- 治理票占比 = 有效治理票数 / 总治理票数

已申请解锁则不参与激励分配。

## 4. 验证结果生成

在第 n 轮的验证阶段以下 4 种交互，会先触发第 n 轮的验证结果生成，再完成后续交互：

- 质押代币
- 申请解除质押
- 领取质押代币
- 铸造激励

注意：若某一轮的验证阶段，未发生上述 4 种交互，则无法生成验证结果，无法进行激励分配
